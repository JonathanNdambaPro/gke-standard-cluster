{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Event-Driven GCP - GKE Extension","text":"<p>This documentation covers the GKE Standard Cluster extension of the Event-Driven GCP project.</p>"},{"location":"#overview","title":"Overview","text":"<p>We have extended the platform to support a production-grade Kubernetes environment using GKE Standard. This replaces or augments the Cloud Run setup for workloads requiring long-running processes, stateful sets, or complex orchestration.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>VPC-Native Cluster: Integrated directly with your GCP VPC for performance and security.</li> <li>Cost-Optimized Node Pools: Separate node pools with support for Spot/Preemptible instances.</li> <li>Automated DNS: Cloud DNS management for your domain (<code>templatejojotest.com</code>).</li> <li>Global Ingress: Google Cloud Global Load Balancer with managed SSL certificates.</li> <li>Infrastructure as Code: Everything is defined in Terraform modules.</li> </ul>"},{"location":"configuration-sync/","title":"Configuration Sync","text":""},{"location":"configuration-sync/#source-of-truth-configyaml","title":"Source of Truth: <code>config.yaml</code>","text":"<p>The <code>config.yaml</code> file at the project root is the source of truth for shared values. The CI/CD workflow automatically parses it using <code>yq</code>.</p> <pre><code># Central project configuration\ngcp:\n  project_id: dataascode\n  region: europe-west1\n\ngke:\n  cluster_name: template-gke-cluster\n\nartifactory:\n  repository_id: docker-repository\n\napp:\n  image_name: event-driven\n  service_name: event-driven-api  # Must match fullnameOverride in values.yaml\n</code></pre> <p>\u26a0\ufe0f The following files must be manually synchronized with <code>config.yaml</code>: - <code>infra/terraform/tfvars/main.tfvars</code> - <code>infra/terraform/tfvars/local.tfvars</code> - <code>infra/helm/values.yaml</code></p>"},{"location":"configuration-sync/#mapping-table","title":"Mapping Table","text":"Value <code>.github/workflows/main.yml</code> <code>infra/terraform/tfvars/main.tfvars</code> <code>infra/helm/values.yaml</code> Project ID <code>GCP_PROJECT_ID: dataascode</code> <code>project = \"dataascode\"</code> - Region <code>GCP_ZONE: europe-west1</code> <code>region = \"europe-west1\"</code> - Cluster Name <code>GKE_CLUSTER_NAME: template-gke-cluster</code> <code>gke_cluster_name = \"template-gke-cluster\"</code> - Artifact Repository <code>REPO_ARTIFACTORY: docker-repository</code> <code>artifactory_repository_id = \"docker-repository\"</code> - K8s Service Name - <code>eventarc_service_name = \"event-driven-api\"</code> <code>fullnameOverride: \"event-driven-api\"</code>"},{"location":"configuration-sync/#file-details","title":"File Details","text":""},{"location":"configuration-sync/#githubworkflowsmainyml","title":"<code>.github/workflows/main.yml</code>","text":"<pre><code>env:\n  GCP_PROJECT_ID: dataascode          # \u2192 main.tfvars: project\n  GCP_ZONE: europe-west1              # \u2192 main.tfvars: region\n  REPO_ARTIFACTORY: docker-repository # \u2192 main.tfvars: artifactory_repository_id\n  GKE_CLUSTER_NAME: template-gke-cluster # \u2192 main.tfvars: gke_cluster_name\n</code></pre>"},{"location":"configuration-sync/#infraterraformtfvarsmaintfvars","title":"<code>infra/terraform/tfvars/main.tfvars</code>","text":"<pre><code>project = \"dataascode\"                      # \u2192 main.yml: GCP_PROJECT_ID\nregion  = \"europe-west1\"                    # \u2192 main.yml: GCP_ZONE\ngke_cluster_name = \"template-gke-cluster\"   # \u2192 main.yml: GKE_CLUSTER_NAME\nartifactory_repository_id = \"docker-repository\" # \u2192 main.yml: REPO_ARTIFACTORY\neventarc_service_name = \"event-driven-api\"  # \u2192 values.yaml: fullnameOverride\n</code></pre>"},{"location":"configuration-sync/#infrahelmvaluesyaml","title":"<code>infra/helm/values.yaml</code>","text":"<pre><code>fullnameOverride: \"event-driven-api\"  # \u2192 main.tfvars: eventarc_service_name\n</code></pre>"},{"location":"configuration-sync/#modification-checklist","title":"Modification Checklist","text":""},{"location":"configuration-sync/#change-gcp-project-name","title":"Change GCP Project Name","text":"<ul> <li>[ ] <code>.github/workflows/main.yml</code> \u2192 <code>GCP_PROJECT_ID</code></li> <li>[ ] <code>infra/terraform/tfvars/main.tfvars</code> \u2192 <code>project</code></li> <li>[ ] <code>infra/terraform/tfvars/local.tfvars</code> \u2192 <code>project</code></li> </ul>"},{"location":"configuration-sync/#change-region","title":"Change Region","text":"<ul> <li>[ ] <code>.github/workflows/main.yml</code> \u2192 <code>GCP_ZONE</code></li> <li>[ ] <code>infra/terraform/tfvars/main.tfvars</code> \u2192 <code>region</code></li> <li>[ ] <code>infra/terraform/tfvars/local.tfvars</code> \u2192 <code>region</code></li> </ul>"},{"location":"configuration-sync/#change-gke-cluster-name","title":"Change GKE Cluster Name","text":"<ul> <li>[ ] <code>.github/workflows/main.yml</code> \u2192 <code>GKE_CLUSTER_NAME</code></li> <li>[ ] <code>infra/terraform/tfvars/main.tfvars</code> \u2192 <code>gke_cluster_name</code></li> <li>[ ] <code>infra/terraform/tfvars/local.tfvars</code> \u2192 <code>gke_cluster_name</code></li> </ul>"},{"location":"configuration-sync/#change-artifact-registry-repository-name","title":"Change Artifact Registry Repository Name","text":"<ul> <li>[ ] <code>.github/workflows/main.yml</code> \u2192 <code>REPO_ARTIFACTORY</code></li> <li>[ ] <code>infra/terraform/tfvars/main.tfvars</code> \u2192 <code>artifactory_repository_id</code></li> <li>[ ] <code>infra/terraform/tfvars/local.tfvars</code> \u2192 <code>artifactory_repository_id</code></li> </ul>"},{"location":"configuration-sync/#change-kubernetes-service-name","title":"Change Kubernetes Service Name","text":"<ul> <li>[ ] <code>infra/terraform/tfvars/main.tfvars</code> \u2192 <code>eventarc_service_name</code></li> <li>[ ] <code>infra/terraform/tfvars/local.tfvars</code> \u2192 <code>eventarc_service_name</code></li> <li>[ ] <code>infra/helm/values.yaml</code> \u2192 <code>fullnameOverride</code></li> </ul>"},{"location":"configuration-sync/#important-notes","title":"\u26a0\ufe0f Important Notes","text":"<ol> <li> <p>K8s service name (<code>eventarc_service_name</code> / <code>fullnameOverride</code>) must be identical because Eventarc uses this name to route events to the correct service.</p> </li> <li> <p>Artifact Registry repository must exist before pushing Docker images.</p> </li> <li> <p>GKE cluster must exist before Helm deployment.</p> </li> </ol>"},{"location":"infrastructure/","title":"Infrastructure (Terraform) \ud83c\udfd7\ufe0f","text":"<p>The infrastructure is managed via Terraform and organized into reusable modules.</p>"},{"location":"infrastructure/#modules","title":"Modules","text":""},{"location":"infrastructure/#gke-cluster","title":"<code>gke-cluster</code>","text":"<p>Provisions the GKE Standard cluster. *   Best Practice: Uses <code>remove_default_node_pool = true</code> to allow safer node pool upgrades. *   Node Pools: Defined as separate <code>google_container_node_pool</code> resources. *   Networking: Enforces VPC-native IPs using <code>ip_allocation_policy</code>.</p>"},{"location":"infrastructure/#cloud-dns","title":"<code>cloud-dns</code>","text":"<p>Manages the Google Cloud DNS zone and records. *   Inputs: Accepts a list of external IPs to create <code>A</code> records automatically. *   Outputs: Exports nameservers for domain registration.</p>"},{"location":"infrastructure/#cloud-domains","title":"<code>cloud-domains</code>","text":"<p>Optional Module. Automates the purchase and configuration of a domain name. *   Resource: <code>google_clouddomains_registration</code> *   Contact Info: Requires real physical address and contact details (Privacy Redacted by default).</p>"},{"location":"infrastructure/#network","title":"<code>network</code>","text":"<p>Sets up the foundational networking. *   Global IP: Reserves a static global IP for the GKE Ingress (<code>google_compute_global_address</code>). *   VPC/Subnet: Creates the dedicated network for the cluster.</p>"},{"location":"infrastructure/#deployment","title":"Deployment","text":"<p>To deploy the infrastructure:</p> <pre><code># 1. Initialize\nmake init_local_terraform\n\n# 2. Plan\nmake plan_local_terraform\n\n# 3. Apply\nmake apply_local_terraform\n</code></pre>"},{"location":"kubernetes/","title":"Kubernetes &amp; Ingress \u2638\ufe0f","text":"<p>This section details how applications are exposed on the GKE cluster.</p>"},{"location":"kubernetes/#ingress-architecture","title":"Ingress Architecture","text":"<p>We use the GKE Ingress Controller (GCE L7 Load Balancer).</p> <ol> <li>ManagedCertificate: Google-managed SSL certificate for <code>templatejojotest.com</code>.</li> <li>FrontendConfig: Configures HTTP-&gt;HTTPS redirection.</li> <li>Ingress: Defines the host rules and backend routing.</li> <li>Service: <code>NodePort</code> service is required for the Ingress Controller to route traffic.</li> </ol>"},{"location":"kubernetes/#troubleshooting-ingress","title":"Troubleshooting Ingress","text":"<p>Common issues and fixes during deployment.</p>"},{"location":"kubernetes/#502-bad-gateway-server-error","title":"502 Bad Gateway / Server Error","text":"<p>This usually means the Load Balancer cannot reach your Pods.</p> <p>Checklist: 1.  Health Code 502: Use <code>kubectl describe ingress</code> and look at the <code>Backends</code> column.     *   If it says <code>Unhealthy</code> or <code>Unknown</code>, the health check is failing. 2.  Port Mismatch (Common Error):     *   Container Port: Check your <code>Dockerfile</code> (e.g., <code>EXPOSE 80</code>).     *   Deployment Port: <code>containerPort</code> must match the Dockerfile port.     *   Service Port: <code>targetPort</code> must match the <code>containerPort</code>. 3.  Selector Mismatch:     *   Ensure <code>Service.spec.selector</code> matches <code>Deployment.spec.template.metadata.labels</code>.</p> <p>Debug Command:</p> <pre><code># Check if pods are running\nkubectl get pods\n\n# Check logs to confirm port\nkubectl logs -l app=&lt;your-app-label&gt;\n\n# Describe ingress to see backend health\nkubectl describe ingress &lt;ingress-name&gt;\n</code></pre>"}]}